(()=>{var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};(()=>{"use strict";const t=flarum.core.compat["forum/app"];var n=e.n(t);function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var o="data-lb-moreformat-mounted";function a(){var e=document.querySelector('.ProseMirror[contenteditable="true"]');return e||(document.querySelector('.RichText-editor[contenteditable="true"]')||null)}function i(){return document.querySelector(".TextEditor textarea")}function l(e){var t=a();if(t)return t.focus(),document.execCommand("insertText",!1,e),!0;var n=i();if(n){var r,o,l=null!=(r=n.selectionStart)?r:n.value.length,u=null!=(o=n.selectionEnd)?o:l;return n.value=n.value.slice(0,l)+e+n.value.slice(u),n.selectionStart=n.selectionEnd=l+e.length,n.dispatchEvent(new Event("input",{bubbles:!0})),n.focus(),!0}return!1}function u(){var e=a();if(e)return e.focus(),document.execCommand("insertParagraph"),!0;var t=i();if(t){var n,r,o=null!=(n=t.selectionStart)?n:t.value.length,l=null!=(r=t.selectionEnd)?r:o;return t.value=t.value.slice(0,o)+"\n"+t.value.slice(l),t.selectionStart=t.selectionEnd=o+1,t.dispatchEvent(new Event("input",{bubbles:!0})),t.focus(),!0}return!1}function c(e){var t="["+e+"]",n="[/"+e+"]",r=a();if(r){var o;r.focus();var l=window.getSelection(),u=l&&l.rangeCount?l.getRangeAt(0):null,c=u?u.startContainer:r;c.nodeType===Node.TEXT_NODE&&(c=c.parentNode);var s=null==(o=c)?void 0:o.closest("h1,h2,h3,h4,h5,p,li,blockquote,div");if(s||(s=r),u&&l){var d,f,v=null==(d=3===u.startContainer.nodeType?u.startContainer.parentNode:u.startContainer)?void 0:d.closest("h1,h2,h3,h4,h5,p,li,blockquote,div"),b=null==(f=3===u.endContainer.nodeType?u.endContainer.parentNode:u.endContainer)?void 0:f.closest("h1,h2,h3,h4,h5,p,li,blockquote,div");if(v&&b&&v!==b)return document.execCommand("insertText",!1,t+l.toString()+n),!0}var h=s.parentNode;if(h){var m=s.previousSibling&&s.previousSibling.nodeType===Node.TEXT_NODE&&s.previousSibling.data.endsWith("\n")?"":"\n",p=document.createTextNode((s===r?"":m)+t+"\n");h.insertBefore(p,s);var y=s.nextSibling&&s.nextSibling.nodeType===Node.TEXT_NODE&&s.nextSibling.data.startsWith("\n")?"":"\n",g=document.createTextNode(y+n);s.nextSibling?h.insertBefore(g,s.nextSibling):h.appendChild(g)}return!0}var S=i();if(S){var E,x,T=S.value,A=null!=(E=S.selectionStart)?E:0,k=null!=(x=S.selectionEnd)?x:A,C=T.lastIndexOf("\n",A-1)+1,N=-1===T.indexOf("\n",k)?T.length:T.indexOf("\n",k),O=T.slice(0,C),q=T.slice(C,N),w=T.slice(N);O.endsWith("\n")||O.length,w.startsWith("\n")||w.length,S.value=O+t+"\n"+q+"\n"+n+(w.startsWith("\n")?w:"\n"+w);var _=(O+t+"\n"+q+"\n"+n+"\n").length;return S.selectionStart=S.selectionEnd=_,S.dispatchEvent(new Event("input",{bubbles:!0})),S.focus(),!0}return!1}function s(e,t){try{var r=n().translator.trans(e);return r&&r!==e?r:t}catch(e){return t}}var d=[{key:"blank-1",i18nKey:"lady-byron-more-format.forum.blank_paragraph",fallback:"空白段落",icon:"fas fa-paragraph",run:function(){return function(e){void 0===e&&(e=1);for(var t=0;t<e;t++)u(),l(" "),u()}(1)}},{key:"indent",i18nKey:"lady-byron-more-format.forum.indent",fallback:"段首缩进",icon:"fas fa-indent",run:function(){l("　　")}},{key:"center",i18nKey:"lady-byron-more-format.forum.center",fallback:"居中",icon:"fas fa-align-center",run:function(){return c("center")}},{key:"right",i18nKey:"lady-byron-more-format.forum.right",fallback:"右对齐",icon:"fas fa-align-right",run:function(){return c("right")}}];function f(e){if(!e.getAttribute(o)){e.setAttribute(o,"1");for(var t,n,a,i=(n=(t=e).querySelectorAll(".ButtonGroup")).length?n[n.length-1]:t,l=function(){var e=a.value,t=document.createElement("button");t.type="button",t.className="Button Button--icon",t.innerHTML='<i class="'+e.icon+'"></i>',function(e,t,n){var r=s(t,n);e.setAttribute("title",r),e.setAttribute("aria-label",r),requestAnimationFrame(function(){var r=s(t,n);e.setAttribute("title",r),e.setAttribute("aria-label",r)}),setTimeout(function(){var r=s(t,n);e.setAttribute("title",r),e.setAttribute("aria-label",r)},300)}(t,e.i18nKey,e.fallback),t.addEventListener("click",function(t){t.preventDefault(),e.run()}),i.appendChild(t)},u=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(d);!(a=u()).done;)l()}}n().initializers.add("lady-byron/more-format",function(){var e,t,r=function(){return Array.from(document.querySelectorAll(".RichTextEditor-toolbar, .TextEditor-controls")).forEach(f)};r(),new MutationObserver(r).observe(document.body,{childList:!0,subtree:!0}),null==(e=n().history)||null==e.on||e.on("push",r),null==(t=n().history)||null==t.on||t.on("pop",r)})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map