{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://lady-byron-more-format/external assign \"flarum.extensions['askvortsov-rich-text']\"","webpack://lady-byron-more-format/webpack/bootstrap","webpack://lady-byron-more-format/webpack/runtime/compat get default export","webpack://lady-byron-more-format/webpack/runtime/define property getters","webpack://lady-byron-more-format/webpack/runtime/hasOwnProperty shorthand","webpack://lady-byron-more-format/external root \"flarum.core.compat['forum/app']\"","webpack://lady-byron-more-format/external root \"flarum.core.compat['common/extend']\"","webpack://lady-byron-more-format/external root \"flarum.core.compat['common/components/Button']\"","webpack://lady-byron-more-format/./src/forum/index.tsx"],"sourcesContent":["if(typeof flarum.extensions['askvortsov-rich-text'] === 'undefined') { var e = new Error(\"Cannot find module 'flarum.extensions['askvortsov-rich-text']'\"); e.code = 'MODULE_NOT_FOUND'; throw e; }\n\nmodule.exports = flarum.extensions['askvortsov-rich-text'];","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport Button from 'flarum/common/components/Button';\n\n// --- 翻译助手（取不到就用回退文案）\nconst t = (key: string, fallback: string) => {\n  const s = (app.translator.trans(key) as unknown) as string;\n  return !s || s === key ? fallback : s;\n};\n\n// --- RTE 操作：空白段/缩进/BBCode 包裹\nfunction insertBlankParagraph(editor: any) {\n  editor.chain().focus().insertContent({ type: 'paragraph' }).insertContent('\\u00A0').insertContent({ type: 'paragraph' }).run();\n}\n\nfunction insertIndent(editor: any) {\n  try {\n    const { state } = editor;\n    const $from = state.selection.$from;\n    const start = $from.start($from.depth);\n    editor.chain().focus().setTextSelection({ from: start, to: start }).insertContent('\\u3000\\u3000').run();\n  } catch {\n    editor.chain().focus().insertContent('\\u3000\\u3000').run();\n  }\n}\n\nfunction wrapWithTag(editor: any, tag: 'center' | 'right') {\n  const open = `[${tag}]`;\n  const close = `[/${tag}]`;\n  const sel = editor.state.selection;\n\n  if (!sel || sel.empty) {\n    editor.chain().focus().insertContent(open + close).run();\n    const posAfter = editor.state.selection.from;\n    const inside = posAfter - close.length;\n    editor.chain().setTextSelection({ from: inside, to: inside }).run();\n    return;\n  }\n\n  const from = sel.from;\n  const to = sel.to;\n  const selectedText = editor.state.doc.textBetween(from, to, '\\n');\n\n  editor.chain().focus().deleteRange({ from, to }).insertContent(open + selectedText + close).run();\n}\n\napp.initializers.add('lady-byron/more-format', () => {\n  // ❶ 运行时再“拿”别的扩展，确保已加载；并兼容不同导出形态\n  let rich: any;\n  try {\n    // 需要在 webpack.config.js 里 useExtensions: ['askvortsov-rich-text']\n    // 这样这里才有 @askvortsov-rich-text 可用\n    // eslint-disable-next-line @typescript-eslint/no-var-requires\n    rich = require('@askvortsov-rich-text');\n  } catch (e) {\n    console.warn('[more-format] @askvortsov-rich-text not available', e);\n    return; // 避免初始化失败\n  }\n\n  const RichTextEditor =\n    rich?.components?.RichTextEditor ||\n    rich?.RichTextEditor ||\n    rich?.default?.components?.RichTextEditor ||\n    rich?.default?.RichTextEditor;\n\n  if (!RichTextEditor) {\n    console.warn('[more-format] RichTextEditor export not found on @askvortsov-rich-text', rich);\n    return; // 避免初始化失败\n  }\n\n  // ❷ 正式向 RTE 工具栏注入按钮\n  extend(RichTextEditor.prototype as any, 'toolbarItems', function (items: any) {\n    const editor = (this as any).editor || (this as any).attrs?.editor;\n    if (!editor || !editor.chain) return;\n\n    items.add(\n      'lb-blank-paragraph',\n      <Button\n        className=\"Button Button--icon\"\n        icon=\"fas fa-paragraph\"\n        title={t('lady-byron-more-format.forum.blank_paragraph', '空白段落')}\n        onclick={() => insertBlankParagraph(editor)}\n      />,\n      30\n    );\n\n    items.add(\n      'lb-indent',\n      <Button\n        className=\"Button Button--icon\"\n        icon=\"fas fa-indent\"\n        title={t('lady-byron-more-format.forum.indent', '段首缩进')}\n        onclick={() => insertIndent(editor)}\n      />,\n      29\n    );\n\n    items.add(\n      'lb-center',\n      <Button\n        className=\"Button Button--icon\"\n        icon=\"fas fa-align-center\"\n        title={t('lady-byron-more-format.forum.center', '居中')}\n        onclick={() => wrapWithTag(editor, 'center')}\n      />,\n      28\n    );\n\n    items.add(\n      'lb-right',\n      <Button\n        className=\"Button Button--icon\"\n        icon=\"fas fa-align-right\"\n        title={t('lady-byron-more-format.forum.right', '右对齐')}\n        onclick={() => wrapWithTag(editor, 'right')}\n      />,\n      27\n    );\n  });\n});\n\n\n"],"names":["flarum","extensions","e","Error","code","module","exports","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","core","compat","t","fallback","s","app","trans","wrapWithTag","editor","tag","open","close","sel","state","selection","empty","from","to","selectedText","doc","textBetween","chain","focus","deleteRange","insertContent","run","inside","length","setTextSelection","add","_rich","_rich2","_rich3","_rich4","rich","require","console","warn","RichTextEditor","components","extend","items","_attrs","this","attrs","m","Button","className","icon","title","onclick","type","insertBlankParagraph","$from","start","depth","_unused","insertIndent"],"sourceRoot":""}