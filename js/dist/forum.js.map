{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://lady-byron-more-format/webpack/bootstrap","webpack://lady-byron-more-format/webpack/runtime/compat get default export","webpack://lady-byron-more-format/webpack/runtime/define property getters","webpack://lady-byron-more-format/webpack/runtime/hasOwnProperty shorthand","webpack://lady-byron-more-format/external root \"flarum.core.compat['forum/app']\"","webpack://lady-byron-more-format/./src/forum/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","import app from 'flarum/forum/app';\n\nconst MARK_ATTR = 'data-lb-moreformat-mounted';\n\nfunction findToolbars(): Element[] {\n  return Array.from(\n    document.querySelectorAll('.RichTextEditor-toolbar, .TextEditor-controls')\n  );\n}\n\nfunction insertIndent() {\n  // 段首缩进：两个全角空格（U+3000）\n  const rted = document.querySelector('.RichText-editor[contenteditable=\"true\"]') as HTMLElement | null;\n  if (rted) {\n    rted.focus();\n    document.execCommand('insertText', false, '\\u3000\\u3000');\n    return;\n  }\n  const ta = document.querySelector('.TextEditor textarea') as HTMLTextAreaElement | null;\n  if (ta) {\n    const start = ta.selectionStart ?? ta.value.length;\n    const end = ta.selectionEnd ?? start;\n    const s = '\\u3000\\u3000';\n    ta.value = ta.value.slice(0, start) + s + ta.value.slice(end);\n    ta.selectionStart = ta.selectionEnd = start + s.length;\n    ta.dispatchEvent(new Event('input', { bubbles: true }));\n    ta.focus();\n  }\n}\n\nfunction insertBlankParagraph() {\n  // 空白段落：一整段只有 NBSP 的段落\n  const rted = document.querySelector('.RichText-editor[contenteditable=\"true\"]') as HTMLElement | null;\n  if (rted) {\n    rted.focus();\n    // 新段 -> NBSP -> 再起新段，让 NBSP 段独立存在\n    document.execCommand('insertParagraph');                   // 开一个新段\n    document.execCommand('insertText', false, '\\u00A0');       // 放入 NBSP 字符（不是 \"&nbsp;\"）\n    document.execCommand('insertParagraph');                   // 再开下一段\n    return;\n  }\n  // 纯文本编辑器回退：插入 \\n NBSP \\n\n  const ta = document.querySelector('.TextEditor textarea') as HTMLTextAreaElement | null;\n  if (ta) {\n    const start = ta.selectionStart ?? ta.value.length;\n    const end = ta.selectionEnd ?? start;\n    const s = '\\n\\u00A0\\n';\n    ta.value = ta.value.slice(0, start) + s + ta.value.slice(end);\n    ta.selectionStart = ta.selectionEnd = start + s.length;\n    ta.dispatchEvent(new Event('input', { bubbles: true }));\n    ta.focus();\n  }\n}\n\nfunction mountButtons(toolbar: Element) {\n  const root = toolbar as HTMLElement;\n  if (root.getAttribute(MARK_ATTR)) return;\n  root.setAttribute(MARK_ATTR, '1');\n\n  const group = root.querySelector('.ButtonGroup') ?? root;\n\n  const mk = (title: string, icon: string, onClick: () => void) => {\n    const btn = document.createElement('button');\n    btn.type = 'button';\n    btn.className = 'Button Button--icon';\n    btn.title = title;\n    btn.innerHTML = `<i class=\"${icon}\"></i>`;\n    btn.addEventListener('click', (e) => {\n      e.preventDefault();\n      onClick();\n    });\n    return btn;\n  };\n\n  const btnBlank = mk(\n    (app.translator.trans('lady-byron-more-format.forum.blank_paragraph') as unknown) as string,\n    'fas fa-paragraph',\n    insertBlankParagraph\n  );\n\n  const btnIndent = mk(\n    (app.translator.trans('lady-byron-more-format.forum.indent') as unknown) as string,\n    'fas fa-indent',\n    insertIndent\n  );\n\n  group.appendChild(btnBlank);\n  group.appendChild(btnIndent);\n}\n\napp.initializers.add('lady-byron/more-format', () => {\n  const tick = () => findToolbars().forEach(mountButtons);\n  tick();\n  new MutationObserver(tick).observe(document.body, { childList: true, subtree: true });\n  (app.history as any)?.on?.('push', tick);\n  (app.history as any)?.on?.('pop', tick);\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","core","compat","MARK_ATTR","insertIndent","rted","document","querySelector","focus","execCommand","ta","_ta$selectionStart","_ta$selectionEnd","start","selectionStart","value","length","end","selectionEnd","slice","s","dispatchEvent","Event","bubbles","insertBlankParagraph","_ta$selectionStart2","_ta$selectionEnd2","mountButtons","toolbar","_root$querySelector","root","getAttribute","setAttribute","group","mk","title","icon","onClick","btn","createElement","type","className","innerHTML","addEventListener","e","preventDefault","btnBlank","app","trans","btnIndent","appendChild","add","_app$history","_app$history2","tick","Array","from","querySelectorAll","forEach","MutationObserver","observe","body","childList","subtree","on"],"sourceRoot":""}