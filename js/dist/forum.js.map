{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://lady-byron-more-format/webpack/bootstrap","webpack://lady-byron-more-format/webpack/runtime/compat get default export","webpack://lady-byron-more-format/webpack/runtime/define property getters","webpack://lady-byron-more-format/webpack/runtime/hasOwnProperty shorthand","webpack://lady-byron-more-format/external root \"flarum.core.compat['forum/app']\"","webpack://lady-byron-more-format/./src/forum/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","import app from 'flarum/forum/app';\n\nconst MARK_ATTR = 'data-lb-moreformat-mounted';\n\n// —— 统一找“当前可编辑区”：优先富文本(.ProseMirror)，其次旧文本框 ——\nfunction getRteEditable(): HTMLElement | null {\n  // RTE 的真实编辑区\n  const pm = document.querySelector('.ProseMirror[contenteditable=\"true\"]') as HTMLElement | null;\n  if (pm) return pm;\n\n  // 某些主题旧类名（备援）\n  const r1 = document.querySelector('.RichText-editor[contenteditable=\"true\"]') as HTMLElement | null;\n  if (r1) return r1;\n\n  return null;\n}\nfunction getTextarea(): HTMLTextAreaElement | null {\n  return document.querySelector('.TextEditor textarea') as HTMLTextAreaElement | null;\n}\n\n// —— 基础操作：插入文字、起新段（同时兼容 RTE / 旧编辑器） ——\nfunction insertTextRT(text: string) {\n  const ed = getRteEditable();\n  if (ed) {\n    ed.focus();\n    document.execCommand('insertText', false, text); // 由 ProseMirror 接管\n    return true;\n  }\n  const ta = getTextarea();\n  if (ta) {\n    const start = ta.selectionStart ?? ta.value.length;\n    const end = ta.selectionEnd ?? start;\n    ta.value = ta.value.slice(0, start) + text + ta.value.slice(end);\n    ta.selectionStart = ta.selectionEnd = start + text.length;\n    ta.dispatchEvent(new Event('input', { bubbles: true }));\n    ta.focus();\n    return true;\n  }\n  return false;\n}\n\nfunction insertParagraphRT() {\n  const ed = getRteEditable();\n  if (ed) {\n    ed.focus();\n    document.execCommand('insertParagraph');        // 触发 RTE 的起段逻辑\n    return true;\n  }\n  const ta = getTextarea();\n  if (ta) {\n    const start = ta.selectionStart ?? ta.value.length;\n    const end = ta.selectionEnd ?? start;\n    ta.value = ta.value.slice(0, start) + '\\n' + ta.value.slice(end);\n    ta.selectionStart = ta.selectionEnd = start + 1;\n    ta.dispatchEvent(new Event('input', { bubbles: true }));\n    ta.focus();\n    return true;\n  }\n  return false;\n}\n\n// —— 现有两个功能 ——\nfunction runIndent() { insertTextRT('\\u3000\\u3000'); }\n\nfunction runBlank(n = 1) {\n  for (let i = 0; i < n; i++) {\n    insertParagraphRT();                 // 开新段\n    insertTextRT('\\u00A0');              // 放入真实 NBSP（不是字面“&nbsp;”）\n    insertParagraphRT();                 // 再开下一段\n  }\n}\n\n// —— 工具栏挂载（保持不变） ——\ntype Tool = { key: string; title: string; icon: string; run: () => void; };\nconst tools: Tool[] = [\n  { key: 'blank-1', title: app.translator.trans('lady-byron-more-format.forum.blank_paragraph') as any, icon: 'fas fa-paragraph', run: () => runBlank(1) },\n  { key: 'indent',  title: app.translator.trans('lady-byron-more-format.forum.indent') as any,         icon: 'fas fa-indent',    run: runIndent },\n];\n\nfunction findToolbars(): Element[] {\n  // 兼容富文本和原生工具栏\n  return Array.from(document.querySelectorAll('.RichTextEditor-toolbar, .TextEditor-controls'));\n}\n\nfunction mountButtons(toolbar: Element) {\n  const root = toolbar as HTMLElement;\n  if (root.getAttribute(MARK_ATTR)) return;\n  root.setAttribute(MARK_ATTR, '1');\n\n  const group = root.querySelector('.ButtonGroup') ?? root;\n\n  for (const t of tools) {\n    const btn = document.createElement('button');\n    btn.type = 'button';\n    btn.className = 'Button Button--icon';\n    btn.title = t.title;\n    btn.innerHTML = `<i class=\"${t.icon}\"></i>`;\n    btn.addEventListener('click', (e) => { e.preventDefault(); t.run(); });\n    group.appendChild(btn);\n  }\n}\n\napp.initializers.add('lady-byron/more-format', () => {\n  const tick = () => findToolbars().forEach(mountButtons);\n  tick();\n  new MutationObserver(tick).observe(document.body, { childList: true, subtree: true });\n  (app.history as any)?.on?.('push', tick);\n  (app.history as any)?.on?.('pop', tick);\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","core","compat","MARK_ATTR","getRteEditable","pm","document","querySelector","getTextarea","insertTextRT","text","ed","focus","execCommand","ta","_ta$selectionStart","_ta$selectionEnd","start","selectionStart","value","length","end","selectionEnd","slice","dispatchEvent","Event","bubbles","insertParagraphRT","_ta$selectionStart2","_ta$selectionEnd2","tools","title","app","trans","icon","run","n","i","runBlank","mountButtons","toolbar","_root$querySelector","root","getAttribute","setAttribute","_step","group","_loop","t","btn","createElement","type","className","innerHTML","addEventListener","e","preventDefault","appendChild","_iterator","_createForOfIteratorHelperLoose","done","add","_app$history","_app$history2","tick","Array","from","querySelectorAll","forEach","MutationObserver","observe","body","childList","subtree","on"],"sourceRoot":""}