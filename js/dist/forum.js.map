{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://lady-byron-more-format/webpack/bootstrap","webpack://lady-byron-more-format/webpack/runtime/compat get default export","webpack://lady-byron-more-format/webpack/runtime/define property getters","webpack://lady-byron-more-format/webpack/runtime/hasOwnProperty shorthand","webpack://lady-byron-more-format/external root \"flarum.core.compat['forum/app']\"","webpack://lady-byron-more-format/external root \"flarum.core.compat['common/extend']\"","webpack://lady-byron-more-format/external root \"flarum.core.compat['common/components/Button']\"","webpack://lady-byron-more-format/external root \"flarum.core.compat['compat/askvortsov-rich-text/forum/components/RichTextEditor']\"","webpack://lady-byron-more-format/./src/forum/index.tsx"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['compat/askvortsov-rich-text/forum/components/RichTextEditor'];","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport Button from 'flarum/common/components/Button';\n\n// ✅ 用 compat 前缀导入其他扩展的导出\nimport RichTextEditor from 'flarum/compat/askvortsov-rich-text/forum/components/RichTextEditor';\n\n// 翻译助手（取不到就用回退文案）\nconst t = (key: string, fallback: string) => {\n  const s = (app.translator.trans(key) as unknown) as string;\n  return !s || s === key ? fallback : s;\n};\n\n// 插入“只含 NBSP 的段落”：新段 -> NBSP -> 新段（中间段就是空白段）\nfunction insertBlankParagraph(editor: any) {\n  editor\n    .chain()\n    .focus()\n    .insertContent({ type: 'paragraph' })\n    .insertContent('\\u00A0')\n    .insertContent({ type: 'paragraph' })\n    .run();\n}\n\n// 段首缩进：两个全角空格 U+3000\nfunction insertIndent(editor: any) {\n  try {\n    const { state } = editor;\n    const $from = state.selection.$from;\n    const start = $from.start($from.depth);\n    editor\n      .chain()\n      .focus()\n      .setTextSelection({ from: start, to: start })\n      .insertContent('\\u3000\\u3000')\n      .run();\n  } catch {\n    editor.chain().focus().insertContent('\\u3000\\u3000').run();\n  }\n}\n\n// 用 BBCode 包裹选区；无选区则插入成对标签并把光标放到中间\nfunction wrapWithTag(editor: any, tag: 'center' | 'right') {\n  const open = `[${tag}]`;\n  const close = `[/${tag}]`;\n  const { state } = editor;\n  const sel = state.selection;\n\n  if (!sel || sel.empty) {\n    editor.chain().focus().insertContent(open + close).run();\n    const posAfter = editor.state.selection.from;\n    const inside = posAfter - close.length;\n    editor.chain().setTextSelection({ from: inside, to: inside }).run();\n    return;\n  }\n\n  const from = sel.from;\n  const to = sel.to;\n  const selectedText = state.doc.textBetween(from, to, '\\n');\n\n  editor\n    .chain()\n    .focus()\n    .deleteRange({ from, to })\n    .insertContent(open + selectedText + close)\n    .run();\n}\n\napp.initializers.add('lady-byron/more-format', () => {\n  extend(RichTextEditor.prototype as any, 'toolbarItems', function (items: any) {\n    const editor = (this as any).editor || (this as any).attrs?.editor;\n    if (!editor || !editor.chain) return;\n\n    // 空白段落\n    items.add(\n      'lb-blank-paragraph',\n      <Button\n        className=\"Button Button--icon\"\n        icon=\"fas fa-paragraph\"\n        title={t('lady-byron-more-format.forum.blank_paragraph', '空白段落')}\n        onclick={() => insertBlankParagraph(editor)}\n      />,\n      30\n    );\n\n    // 段首缩进\n    items.add(\n      'lb-indent',\n      <Button\n        className=\"Button Button--icon\"\n        icon=\"fas fa-indent\"\n        title={t('lady-byron-more-format.forum.indent', '段首缩进')}\n        onclick={() => insertIndent(editor)}\n      />,\n      29\n    );\n\n    // 居中\n    items.add(\n      'lb-center',\n      <Button\n        className=\"Button Button--icon\"\n        icon=\"fas fa-align-center\"\n        title={t('lady-byron-more-format.forum.center', '居中')}\n        onclick={() => wrapWithTag(editor, 'center')}\n      />,\n      28\n    );\n\n    // 右对齐\n    items.add(\n      'lb-right',\n      <Button\n        className=\"Button Button--icon\"\n        icon=\"fas fa-align-right\"\n        title={t('lady-byron-more-format.forum.right', '右对齐')}\n        onclick={() => wrapWithTag(editor, 'right')}\n      />,\n      27\n    );\n  });\n});\n\n\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","core","compat","t","fallback","s","app","trans","wrapWithTag","editor","tag","open","close","state","sel","selection","empty","from","to","selectedText","doc","textBetween","chain","focus","deleteRange","insertContent","run","inside","length","setTextSelection","add","extend","RichTextEditor","items","_attrs","this","attrs","m","Button","className","icon","title","onclick","type","insertBlankParagraph","$from","start","depth","_unused","insertIndent"],"sourceRoot":""}